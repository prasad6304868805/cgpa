<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>SGPA Calculator</title>

<style>
body {
    font-family: Arial, sans-serif;
    background: #eef2f3;
    padding: 20px;
}
.container {
    background: #fff;
    padding: 20px;
    max-width: 1200px;
    margin: auto;
    border-radius: 8px;
}
table {
    width: 100%;
    border-collapse: collapse;
}
th, td {
    border: 1px solid #ccc;
    padding: 6px;
    text-align: center;
}
select {
    width: 100%;
}
button {
    margin-top: 15px;
    padding: 10px;
    width: 100%;
    background: #007bff;
    color: white;
    border: none;
    border-radius: 5px;
}
.result {
    margin-top: 8px;
    font-size: 18px;
    font-weight: bold;
    text-align: center;
}
.invalid {
    color: red;
}
.summary {
    margin-top: 15px;
    padding: 10px;
    background: #f7f9fa;
    border-radius: 6px;
}
</style>
</head>

<body>

<div class="container">
<h2 align="center">SGPA Calculator</h2>

<table>
<tr>
<th>Subject</th>
<th>S1</th>
<th>S2</th>
<th>LE</th>
<th>Credit</th>
<th>Overall Grade</th>
</tr>

<script>
const gradeOptions = `
<option value="">--Select--</option>
<option value="I">I</option>
<option value="10">O</option>
<option value="9">A+</option>
<option value="8">A</option>
<option value="7">B+</option>
<option value="6">B</option>
<option value="5">C</option>
`;

for (let i = 1; i <= 7; i++) {
    document.write(`
    <tr>
        <td>Subject ${i}</td>
        <td><select class="s1" onchange="calcSubject(${i})">${gradeOptions}</select></td>
        <td><select class="s2" onchange="calcSubject(${i})">${gradeOptions}</select></td>
        <td><select class="le" onchange="calcSubject(${i})">${gradeOptions}</select></td>
        <td>
            <select class="credit">
                <option value="">--</option>
                <option value="3">3</option>
                <option value="4">4</option>
            </select>
        </td>
        <td id="sub${i}" data-gp="">--</td>
    </tr>
    `);
}
</script>

<tr>
<td>1 Credit Subject</td>
<td colspan="3">
<select id="oneCredit">
<option value="">--Select--</option>
<option value="10">O</option>
<option value="9">A+</option>
<option value="8">A</option>
<option value="7">B+</option>
<option value="6">B</option>
<option value="5">C</option>
</select>
</td>
<td>1</td>
<td>Overall</td>
</tr>
</table>

<button onclick="calculateSGPA()">Calculate SGPA</button>

<div class="summary">
    <div class="result" id="totalCredits"></div>
    <div class="result" id="cgp"></div>
    <div class="result" id="sgpa"></div>
</div>
</div>

<script>
// Convert RAW GP → final grade point (TABLE LOGIC)
function convertGP(raw) {
    if (raw > 9 && raw <= 10) return { grade: "O", gp: 10 };
    if (raw > 8 && raw <= 9)  return { grade: "A+", gp: 9 };
    if (raw > 7 && raw <= 8)  return { grade: "A", gp: 8 };
    if (raw > 6 && raw <= 7)  return { grade: "B+", gp: 7 };
    if (raw > 5 && raw <= 6)  return { grade: "B", gp: 6 };
    return { grade: "C", gp: 5 };
}

// Calculate subject
function calcSubject(i) {
    let row = document.querySelectorAll("table tr")[i];
    let s1 = row.querySelector(".s1").value;
    let s2 = row.querySelector(".s2").value;
    let le = row.querySelector(".le").value;
    let cell = document.getElementById("sub" + i);

    if (!s1 || !s2 || !le) {
        cell.innerHTML = "--";
        cell.dataset.gp = "";
        return;
    }

    if (s1 === "I" && s2 === "I") {
        cell.innerHTML = "<span class='invalid'>Invalid</span>";
        cell.dataset.gp = "";
        return;
    }

    let rawGP = 0;
    if (s1 !== "I") rawGP += parseInt(s1) * 0.30;
    if (s2 !== "I") rawGP += parseInt(s2) * 0.45;
    if (le !== "I") rawGP += parseInt(le) * 0.25;

    let converted = convertGP(rawGP);

    cell.dataset.gp = converted.gp;      // ✅ STORE FINAL GP (10/9/8...)
    cell.innerHTML = converted.grade;     // ✅ DISPLAY GRADE
}

// Final SGPA
function calculateSGPA() {
    let totalCredits = 0;
    let cumulativeGP = 0;
    let rows = document.querySelectorAll("table tr");

    for (let i = 1; i <= 7; i++) {
        let cell = document.getElementById("sub" + i);
        let gp = cell.dataset.gp;
        let credit = rows[i].querySelector(".credit").value;

        if (!gp || !credit) {
            alert("Complete all subject details");
            return;
        }

        gp = parseInt(gp);
        credit = parseInt(credit);

        cumulativeGP += gp * credit;
        totalCredits += credit;
    }

    let one = document.getElementById("oneCredit").value;
    if (!one) {
        alert("Select 1-credit subject grade");
        return;
    }

    cumulativeGP += parseInt(one) * 1;
    totalCredits += 1;

    let sgpa = cumulativeGP / totalCredits;

    document.getElementById("totalCredits").innerHTML =
        "Total Credits = <b>" + totalCredits + "</b>";

    document.getElementById("cgp").innerHTML =
        "Cumulative Grade Points = <b>" + cumulativeGP + "</b>";

    document.getElementById("sgpa").innerHTML =
        "SGPA = <b>" + sgpa.toFixed(2) + "</b>";
}
</script>

</body>
</html>
